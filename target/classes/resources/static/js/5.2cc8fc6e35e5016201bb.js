webpackJsonp([5],{AWc4:function(t,a){},G1ZL:function(t,a,e){"use strict";Object.defineProperty(a,"__esModule",{value:!0});var i=e("rVsN"),s=e.n(i),n=e("6ROu"),o=e.n(n),r={name:"commentList",props:{data:{type:Array,default:[]}},filters:{dateFormate:function(t){return o.a.locale("zh-cn"),o()(t).fromNow()}}},l={render:function(){var t=this,a=t.$createElement,e=t._self._c||a;return e("div",t._l(t.data,function(a,i){return e("div",{key:i,staticClass:"comment-wrapper"},[e("div",{staticClass:"comment-user-item"},[e("img",{staticClass:"comment-user-image",attrs:{src:a.userhead}})]),t._v(" "),e("div",{staticClass:"comment-user-name"},[e("span",[t._v(t._s(a.username))])]),t._v(" "),e("div",{staticClass:"comment-user-mark"},[e("span",[t._v(t._s(a.score))]),t._v("分")]),t._v(" "),e("div",{staticClass:"comment-time"},[t._v(t._s(t._f("dateFormate")(a.date)))]),t._v(" "),e("div",{staticClass:"comment-content"},[t._v(t._s(a.content))])])}))},staticRenderFns:[]};var c=e("C7Lr")(r,l,!1,function(t){e("V4FF")},"data-v-54ae2974",null).exports,d=e("wSez"),m={name:"bookDetails",data:function(){return{detailData:{},selected:"summary",commentList:[],queryLoading:!1,moreLoading:!1,allLoaded:!1,start:0,limit:5}},components:{commentList:c},created:function(){var t=this;s.a.all([this.getDetail(),this.getComment()]).then(function(a){t.detailData=a[0].data,t.commentList=a[1].data.list,a[1].data.total===a[1].data.list.length&&(t.moreLoading=!0)})},filters:{f1:function(t){if(Array.isArray(t))return t.join(",")},f2:function(t){return 0===t?"架上剩余0本":"立即借阅"}},methods:{getDetail:function(){return this.$axios.get("/api/book/details",{params:{user_id:"22510",ISBN:this.$route.params.id}})},getComment:function(){return this.$axios.get("/api/book/comment",{params:{ISBN:this.$route.params.id,start:this.start,limit:this.limit}})},back:function(){this.$router.go(-1)},initData:function(){this.detailData={},this.commentList=[]},loadMore:function(){var t=this;this.allLoaded?this.moreLoading=!0:this.queryLoading||(this.moreLoading=!0,this.start+=this.limit,this.getComment().then(function(a){t.commentList=t.commentList.concat(a.data.list),t.queryLoading=!1,t.moreLoading=!1,t.allLoaded=a.data.total===t.commentList.length}))},borrow:function(){var t=this;0!==this.detailData.remain&&(d.Indicator.open({text:"邮箱发送中...",spinnerType:"fading-circle"}),this.sendEmail().then(function(a){d.Indicator.close(),0===a.data.code?t.$router.push({path:"/confirmEmail",query:{book_name:t.detailData.title,book_id:t.detailData.bookId,token:a.data.message}}):Object(d.MessageBox)({title:"",message:a.data.message,confirmButtonText:"知道了"})}).catch(function(t){d.Indicator.close(),Object(d.MessageBox)({title:"",message:"请求失败",confirmButtonText:"知道了"})}))},like:function(){var t=this;this.$axios.post("/api/user/like",{user_id:"22510",ISBN:this.detailData.ISBN}).then(function(a){0===a.data.code&&(t.detailData.ifLike=1),Object(d.MessageBox)({title:"",message:a.data.message,confirmButtonText:"知道了"})})},cancelLike:function(){var t=this;this.$axios.delete("/api/user/like",{params:{user_id:"22510",ISBN:this.detailData.ISBN}}).then(function(a){0===a.data.code&&(t.detailData.ifLike=0),Object(d.MessageBox)({title:"",message:a.data.message,confirmButtonText:"知道了"})})},sendEmail:function(){return this.$axios.get("/api/user/getVerification",{params:{user_id:"22510"}})}},activated:function(){var t=this;this.initData(),this.selected="summary",s.a.all([this.getDetail(),this.getComment()]).then(function(a){t.detailData=a[0].data,t.commentList=a[1].data.list})}},u={render:function(){var t=this,a=t.$createElement,e=t._self._c||a;return e("div",[e("mt-header",{attrs:{title:"图书详情",fixed:""}},[e("div",{attrs:{slot:"left"},slot:"left"},[e("mt-button",{attrs:{icon:"back"},on:{click:t.back}},[t._v("返回")])],1),t._v(" "),e("div",{attrs:{slot:"right"},slot:"right"},[e("router-link",{attrs:{to:"/help"}},[e("mt-button",{attrs:{icon:"help"}})],1)],1)]),t._v(" "),e("div",{staticClass:"details-wrapper"},[e("div",{staticClass:"details-info"},[e("div",{staticClass:"details-title"},[e("h1",[t._v(t._s(t.detailData.title))])]),t._v(" "),e("div",{staticClass:"details-image",staticStyle:{"--aspect-ratio":"4/5"}},[e("img",{attrs:{src:t.detailData.image}})]),t._v(" "),e("div",{staticClass:"details-author"},[t._v("\n                作者："+t._s(t._f("f1")(t.detailData.authorArray))+"\n            ")]),t._v(" "),e("div",{staticClass:"details-store"},[t._v("\n                架上剩余："+t._s(t.detailData.remain)+"\n            ")]),t._v(" "),e("div",{staticClass:"details-rating"},[t._v("\n                "+t._s(t.detailData.commentall)+"分\n            ")]),t._v(" "),e("div",{staticClass:"details-like"},[e("mt-button",{staticClass:"el-icon-third-heart",attrs:{size:"small"}},[t._v(t._s(t.detailData.likeAll))])],1)]),t._v(" "),e("div",{staticClass:"present-comment"},[e("div",{staticClass:"tab-bar-panel"},[e("mt-tabbar",{staticClass:"tab-bar",attrs:{id:"tab-bar"},model:{value:t.selected,callback:function(a){t.selected=a},expression:"selected"}},[e("mt-tab-item",{attrs:{id:"summary"}},[e("span",{staticClass:"tab-label"},[t._v("图书介绍")])]),t._v(" "),e("mt-tab-item",{attrs:{id:"comment"}},[e("span",{staticClass:"tab-label"},[t._v("\n                            图书评论"),e("mt-badge",{staticClass:"comment-num",attrs:{type:"error"}},[t._v(t._s(t.commentList.length))])],1)])],1)],1),t._v(" "),e("mt-tab-container",{staticClass:"book-list",model:{value:t.selected,callback:function(a){t.selected=a},expression:"selected"}},[e("mt-tab-container-item",{attrs:{id:"summary"}},[e("p",[t._v(t._s(t.detailData.summary))])]),t._v(" "),e("mt-tab-container-item",{attrs:{id:"comment"}},[e("div",{directives:[{name:"infinite-scroll",rawName:"v-infinite-scroll",value:t.loadMore,expression:"loadMore"}],attrs:{"infinite-scroll-disabled":"moreLoading","infinite-scroll-distance":"20","infinite-scroll-immediate-check":"false"}},[e("comment-list",{attrs:{data:t.commentList}}),t._v(" "),e("div",{staticClass:"more_loading"},[e("mt-spinner",{directives:[{name:"show",rawName:"v-show",value:t.moreLoading&&!t.allLoaded&&t.queryLoading,expression:"moreLoading&&!allLoaded&&queryLoading"}],attrs:{type:"snake",color:"#00ccff",size:8}}),t._v(" "),e("span",{directives:[{name:"show",rawName:"v-show",value:t.allLoaded,expression:"allLoaded"}]},[t._v("已全部加载")])],1)],1)])],1)],1)]),t._v(" "),e("div",{staticClass:"borrow-toolbar"},[e("div",{staticClass:"toolbar-button"},[0===t.detailData.ifLike?e("mt-button",{staticClass:"el-icon-third-heart",attrs:{size:"small"},on:{click:function(a){t.like()}}},[t._v("喜欢")]):e("mt-button",{staticClass:"el-icon-third-heart1 color-red",attrs:{size:"small"},on:{click:function(a){t.cancelLike()}}},[t._v("取消喜欢")])],1),t._v(" "),e("div",{staticClass:"borrow-mark",class:0===t.detailData.remain?"bg-disabled":"bg-enabled",on:{click:t.borrow}},[t._v(t._s(t._f("f2")(t.detailData.remain)))])])],1)},staticRenderFns:[]};var v=e("C7Lr")(m,u,!1,function(t){e("AWc4")},"data-v-1864f2d1",null);a.default=v.exports},V4FF:function(t,a){}});
//# sourceMappingURL=5.2cc8fc6e35e5016201bb.js.map