<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd" >
<mapper namespace="com.hundsun.booklending.mapper.UserMapper">


	<!-- 根据用户id获取用户 -->
	<select id="getUserByUserId" resultType="User">
		select
		u.*
		from user u
		where u.userid=#{userId}
	</select>

	<select id="getAllUser" resultType="User">
		select
		u.*
		from user u
	</select>

	<insert id="saveUser" parameterType="user">
		insert into user
		(userid,password)
		value (#{user.userId},#{user.password})
	</insert>

	<insert id="borrow">
		insert into borrow
		(borrowid,userid,bookid,borrowtime,borrowstatus)
		value
		(#{borrowId},#{userId},#{bookId},#{borrowTime},#{status})
	</insert>

	<select id="searchBorrowDetails" resultType="java.util.Map">
		select b.*,br.*
		from
		book b
		left
		join borrow br
		on
		b.bookid=br.bookid
		where
		br.borrowid=#{borrowId}
		order by br.borrowtime DESC,br.borrowstatus
	</select>

	<select id="searchBorrow" resultType="java.util.Map">
		select b.*,br.*
		from book b
		left
		join borrow br
		on
		b.bookid=br.bookid
		where br.userid=#{userId}
	</select>

	<delete id="deleteBorrow">
		delete from borrow
		where
		borrowid=#{borrowId}
	</delete>

	<insert id="saveCommend">
		insert into commend
		(userid,ISBN,reason,date)
		value
		(#{userId},#{book.ISBN},#{reason},#{date})
	</insert>


	<select id="searchAllBorrow" resultType="java.util.Map">
		select b.*,br.*
		from
		book
		b
		left
		join borrow br
		on
		b.bookid=br.bookid
		where
		br.status=#{status}
	</select>

	<update id="updateBorrow">
		update borrow br
		set br.borrowstatus=#{status},
		br.returntime=#{returnTime}
		where
		bs.borrowid=#{borrowId,jdbcType=VARCHAR}
	</update>

	<update id="updateUser" parameterType="user">
		update user u
		set
		<if test="allloginnum!=null">
			allloginnum=#{user.allloginnum,jdbcType=VARCHAR},
		</if>
		<if test="yearloginnum!=null">
			yearloginnum=#{user.yearloginnum,jdbcType=VARCHAR},
		</if>
		<if test="mouthloginnum!=null">
			mouthloginnum=#{user.mouthloginnum,jdbcType=VARCHAR},
		</if>
		<if test="weekloginnum!=null">
			weekloginnum=#{user.weekloginnum,jdbcType=VARCHAR}
		</if>
		where
		bs.userid=#{user.userid,jdbcType=VARCHAR}
	</update>


</mapper>