(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-aa29"],{"1ffa":function(t,e,a){"use strict";var i=a("978b"),s=a.n(i);s.a},"29b9":function(t,e,a){},4955:function(t,e,a){},"57a4":function(t,e,a){"use strict";var i=a("4955"),s=a.n(i);s.a},"6d5e":function(t,e,a){"use strict";var i=a("fea4"),s=a.n(i);s.a},"90df":function(t,e,a){"use strict";a.r(e);var i=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",[a("div",{staticClass:"wrapper-top"},[a("el-row",{attrs:{gutter:10}},[a("el-col",{attrs:{span:8}},[a("el-card",{attrs:{shadow:"hover","body-style":{padding:"0px"}}},[a("div",{staticClass:"card-wrapper"},[a("div",{staticClass:"card-left"},[a("div",{staticClass:"card-img-icon bg-Burnt-Sienna"},[a("i",{staticClass:"el-icon-third-yuedu"})])]),a("div",{staticClass:"card-right"},[a("p",{staticClass:"card-num"},[t._v(t._s(t.card_num.total))]),a("p",{staticClass:"card-title"},[t._v("图书总量")])])])])],1),a("el-col",{attrs:{span:8}},[a("el-card",{attrs:{shadow:"hover","body-style":{padding:"0px"}}},[a("div",{staticClass:"card-wrapper"},[a("div",{staticClass:"card-left"},[a("div",{staticClass:"card-img-icon bg-Cornflower-Blue"},[a("i",{staticClass:"el-icon-third-tubiaozhizuomoban"})])]),a("div",{staticClass:"card-right"},[a("p",{staticClass:"card-num"},[t._v(t._s(t.card_num.borrow))]),a("p",{staticClass:"card-title"},[t._v("借阅数量")])])])])],1),a("el-col",{attrs:{span:8}},[a("el-card",{attrs:{shadow:"hover","body-style":{padding:"0px"}}},[a("div",{staticClass:"card-wrapper"},[a("div",{staticClass:"card-left"},[a("div",{staticClass:"card-img-icon bg-Malachite"},[a("i",{staticClass:"el-icon-third-shujia"})])]),a("div",{staticClass:"card-right"},[a("p",{staticClass:"card-num"},[t._v(t._s(t.card_num.statistic))]),a("p",{staticClass:"card-title"},[t._v("图书统计")])])])])],1)],1)],1),a("div",{staticClass:"wrapper-main"},[t._m(0),a("div",{staticClass:"search-form"},[a("el-form",{attrs:{inline:!0,model:t.formValues}},[a("el-form-item",{attrs:{label:"ISBN",prop:"ISBN"}},[a("el-input",{attrs:{placeholder:"请输入"},model:{value:t.formValues.ISBN,callback:function(e){t.$set(t.formValues,"ISBN",e)},expression:"formValues.ISBN"}})],1),a("el-form-item",{attrs:{label:"图书名称",prop:"name"}},[a("el-input",{attrs:{placeholder:"请输入"},model:{value:t.formValues.name,callback:function(e){t.$set(t.formValues,"name",e)},expression:"formValues.name"}})],1),a("el-form-item",{attrs:{label:"图书状态",prop:"status"}},[a("el-select",{model:{value:t.formValues.status,callback:function(e){t.$set(t.formValues,"status",e)},expression:"formValues.status"}},[a("el-option",{attrs:{label:"全部",value:""}}),a("el-option",{attrs:{label:"架上",value:"1"}}),a("el-option",{attrs:{label:"借阅中",value:"2"}}),a("el-option",{attrs:{label:"超时未还",value:"3"}})],1)],1),a("el-form-item",[a("el-button",{attrs:{type:"primary"},on:{click:t.getBookByISBN}},[t._v("查询")])],1)],1)],1),a("div",{staticClass:"list-wrapper"},[a("div",{staticClass:"list-title"},[a("i",{staticClass:"el-icon-menu menu-info"}),a("span",[t._v("图书列表")]),a("el-button-group",{staticClass:"toolbar"},[a("el-button",{attrs:{type:"primary",icon:"el-icon-plus"},on:{click:t.addBook}},[t._v("添加")]),a("el-button",{attrs:{type:"primary",icon:"el-icon-delete",disabled:""===t.book_id},on:{click:t.deleteBook}},[t._v("下架")])],1)],1),a("div",{staticClass:"list-main"},[a("div",{staticClass:"list-nav"},[a("div",{staticClass:"menu-content"},[a("el-menu",{ref:"menu",staticClass:"siderbar",attrs:{"background-color":"#dcdfe6","text-color":"#333333","active-text-color":"#ffd04b"},on:{select:t.selectMenu,open:t.clickMenu,close:t.clickMenu}},[t._l(t.bookList,function(e,i){return[a("el-submenu",{key:i,attrs:{index:e.ISBN}},[a("template",{slot:"title"},[t._v("\n                                        "+t._s(e.list[0].title)+"\n                                    ")]),t._l(e.list,function(e,i){return a("el-menu-item",{key:i,attrs:{index:e.bookId}},[a("div",{staticClass:"borrow-status-info"},[a("span",[t._v("编号："+t._s(e.bookId))]),a("el-tag",{attrs:{type:"info"}},[t._v(t._s(t._f("f1")(e.timeout)))])],1)])})],2)]})],2)],1),a("el-pagination",{attrs:{small:"","current-page":t.currentPage,"page-size":t.pageSize,layout:"total, prev, pager, next, jumper",total:t.total},on:{"current-change":t.handlePageChange}})],1),t.showSummary?a("title-info",{staticClass:"list-content",attrs:{bookInfo:t.bookInfo,commentData:t.commentData,commentTitle:t.commentTitle,likeData:t.likeData,likeTitle:t.likeTitle}}):a("borrow-info",{ref:"borrowInfo",staticClass:"list-content",attrs:{book_id:t.book_id}})],1)])]),a("book-dialog",{ref:"dialog",attrs:{form:t.form}}),a("el-dialog",{attrs:{visible:t.dialogPullOfVisible,title:"下架",width:"400px"},on:{"update:visible":function(e){t.dialogPullOfVisible=e}}},[a("div",{staticClass:"pull-off-wrapper"},[a("i",{staticClass:"el-icon-info"}),a("p",{staticClass:"pull-off-info"},[a("span",[t._v("下架该图书")]),a("span",[t._v("下架后，该图书处于“已下架”状态")])])]),a("div",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[a("el-button",{on:{click:function(e){t.dialogPullOfVisible=!1}}},[t._v("取消")]),a("el-button",{attrs:{type:"primary"},on:{click:t.confirmDelete}},[t._v("确定")])],1)])],1)},s=[function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",{staticClass:"main-title"},[a("i",{staticClass:"el-icon-menu menu-info"}),a("span",[t._v("图书信息")])])}],o=(a("7f7f"),a("cadf"),a("551c"),a("097d"),function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("el-dialog",{attrs:{title:t.title,visible:t.dialogFormVisible,width:"680px"},on:{"update:visible":function(e){t.dialogFormVisible=e}}},[a("el-form",{ref:"editForm",attrs:{model:t.form,rules:t.rules}},[a("div",{staticClass:"basic-title"},[t._v("基础信息")]),a("el-col",{attrs:{span:12}},[a("el-form-item",{attrs:{label:"图书编号",prop:"ISBN","label-width":"100px"}},[a("el-input",{model:{value:t.form.ISBN,callback:function(e){t.$set(t.form,"ISBN",e)},expression:"form.ISBN"}})],1)],1),a("el-col",{attrs:{span:12}},[a("el-form-item",{attrs:{label:"库存数量",prop:"size","label-width":"100px"}},[a("el-input-number",{attrs:{"controls-position":"right",min:1},model:{value:t.form.size,callback:function(e){t.$set(t.form,"size",e)},expression:"form.size"}})],1)],1)],1),a("div",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[a("el-button",{on:{click:function(e){t.dialogFormVisible=!1}}},[t._v("取消")]),a("el-button",{directives:[{name:"loading",rawName:"v-loading.fullscreen.lock",value:t.fullscreenLoading,expression:"fullscreenLoading",modifiers:{fullscreen:!0,lock:!0}}],attrs:{type:"primary"},on:{click:t.save}},[t._v("确定")])],1)],1)}),r=[],l={name:"bookDialog",props:{form:Object},data:function(){return{dialogFormVisible:!1,rules:{ISBN:{required:!0,message:"请输入图书编号",trigger:"blur"}},title:"",fullscreenLoading:!1}},methods:{open:function(t){this.dialogFormVisible=!0,this.title=t},save:function(){var t=this;this.$refs.editForm.validate(function(e){e&&(t.fullscreenLoading=!0,t.$axios.post("/api/admin/saveBook",t.form).then(function(e){t.fullscreenLoading=!1,0===e.data.code&&(t.$parent.getBookByISBN(),t.dialogFormVisible=!1),t.$message({message:e.data.message,type:0===e.data.code?"success":"error"})}).catch(function(e){t.$message({message:"请求失败",type:"error"})}))})}}},n=l,c=(a("ded8"),a("2877")),u=Object(c["a"])(n,o,r,!1,null,null,null);u.options.__file="Dialog.vue";var d=u.exports,f=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",{staticClass:"wrapper"},[a("div",{staticClass:"list-info"},[a("div",{staticClass:"list-image"},[a("img",{attrs:{src:t.bookInfo.image}})]),a("div",{staticClass:"list-info-content"},[a("h1",[t._v(t._s(t.bookInfo.title))]),a("div",{staticClass:"list-author"},[t._v("作者: "+t._s(t.bookInfo.author))]),a("div",{staticClass:"list-introduction"},[t._v(t._s(t.bookInfo.summary))])])]),a("el-tabs",{staticClass:"list-card",attrs:{type:"border-card"}},[a("el-tab-pane",{attrs:{label:t.commentTitle}},t._l(t.commentData,function(t,e){return a("list-comment",{key:e,attrs:{data:t}})})),a("el-tab-pane",{attrs:{label:t.likeTitle}},[a("div",{staticClass:"user-wrapper"},t._l(t.likeData,function(e,i){return a("div",{key:i,staticClass:"user-info"},[a("img",{attrs:{src:e.userhead}}),a("div",{staticClass:"user-name"},[t._v(t._s(e.username))])])}))])],1)],1)},m=[],p=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",[a("div",{staticClass:"comment-left"},[a("div",{staticClass:"img-wrapper"},[a("img",{attrs:{src:t.data.userhead}})])]),a("div",{staticClass:"comment-right"},[a("h4",[t._v(t._s(t.data.username))]),a("span",[t._v(t._s(t._f("f1")(t.data.date)))])]),t._m(0)])},b=[function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",{staticClass:"comment-content"},[a("span",{staticClass:"rating"},[t._v("9.4分")]),a("span",[t._v("这本书太赞了，值得看一看!")])])}],v=a("c1df"),h=a.n(v),g={name:"listComment",props:{data:Object},filters:{f1:function(t){return h()(t).format("YYYYMMDD hh:mm:ss")}}},k=g,_=(a("57a4"),Object(c["a"])(k,p,b,!1,null,"06dfef47",null));_.options.__file="ListComment.vue";var w=_.exports,C={name:"titleInfo",components:{listComment:w},props:{bookInfo:Object,commentData:Array,commentTitle:{type:String,default:"评论（0）"},likeData:Array,likeTitle:{type:String,default:"喜欢（0）"}}},y=C,B=(a("1ffa"),Object(c["a"])(y,f,m,!1,null,"7bd7f704",null));B.options.__file="TitleInfo.vue";var I=B.exports,S=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",{staticClass:"wrapper"},[1!==t.borrowUser.borrowstatus?a("div",{staticClass:"user-info"},[a("div",{staticClass:"user-image"},[a("img",{attrs:{src:t.borrowUser.userhead}})]),a("div",{staticClass:"borrow-info"},[a("div",{staticClass:"user-author"},[t._v(t._s(t.borrowUser.username))]),a("div",{staticClass:"time-info"},[a("span",[t._v("开始借阅时间:"+t._s(t._f("f1")(t.borrowUser.borrowtime)))]),a("span",[t._v("结束借阅时间:"+t._s(t._f("f1")(t.borrowUser.returntime)))])])])]):t._e(),a("div",{staticClass:"form-wrapper"},[a("span",[t._v("历史借阅")]),a("el-form",{attrs:{inline:!0}},[a("el-form-item",{attrs:{label:"借阅日期"}},[a("el-date-picker",{attrs:{type:"daterange",align:"right","unlink-panels":"","range-separator":"至","start-placeholder":"开始日期","end-placeholder":"结束日期","picker-options":t.pickerOptions,size:"mini","value-format":"yyyyMMdd"},model:{value:t.value,callback:function(e){t.value=e},expression:"value"}})],1),a("el-form-item",[a("el-button",{attrs:{size:"mini"},on:{click:t.getHistory}},[t._v("查询")])],1)],1)],1),a("div",{staticClass:"list-main"},[a("div",{staticClass:"table-wrapper"},[a("el-table",{attrs:{border:"",data:t.tableData,height:"100%"}},[a("el-table-column",{attrs:{prop:"userid",label:"借阅人ID",align:"left",width:"120"}}),a("el-table-column",{attrs:{prop:"title",label:"昵称",align:"left",width:"120"}}),a("el-table-column",{attrs:{label:"借阅日期",align:"left",width:"180"},scopedSlots:t._u([{key:"default",fn:function(e){return[a("span",[t._v(t._s(t._f("f1")(e.row.borrowtime)))])]}}])}),a("el-table-column",{attrs:{prop:"returntime",label:"还书日期",align:"left",width:"180"},scopedSlots:t._u([{key:"default",fn:function(e){return[a("span",[t._v(t._s(t._f("f1")(e.row.returntime)))])]}}])}),a("el-table-column",{attrs:{prop:"borrowstatus",label:"状态",align:"left",width:"100"},scopedSlots:t._u([{key:"default",fn:function(e){return[a("span",[t._v(t._s(t._f("f2")(e.row.borrowstatus)))])]}}])}),a("el-table-column",{attrs:{label:"延期扣费",align:"left",width:"100"}})],1)],1),a("el-pagination",{attrs:{"current-page":t.currentPage,"page-size":t.pageSize,layout:"total, prev, pager, next, jumper",total:t.total},on:{"current-change":t.handlePageChange}})],1)])},x=[],$={name:"borrowInfo",props:{book_id:{type:String,default:""}},data:function(){return{pickerOptions:{shortcuts:[{text:"本周",onClick:function(t){var e=new Date(h()().isoWeekday(1)),a=new Date(h()().isoWeekday(7));t.$emit("pick",[e,a])}},{text:"本月",onClick:function(t){var e=new Date(h()().year(),h()().month(),1),a=new Date(h()().year(),h()().month(),h()().daysInMonth());t.$emit("pick",[e,a])}},{text:"本年",onClick:function(t){var e=new Date(h()().year(),0,1),a=new Date(h()().year(),11,31);t.$emit("pick",[e,a])}}]},value:"",currentPage:1,pageSize:10,tableData:[],total:0,borrowUser:{userhead:"",username:"",borrowtime:"",returntime:"",borrowstatus:""}}},filters:{f1:function(t){return""===t?"":h()(t).format("YYYY-MM-DD")},f2:function(t){var e={0:"已过期",1:"待取书",2:"未还书",3:"待评价",4:"已还书",8:"已取消",9:"已取消"};return e[t]}},methods:{getHistory:function(){var t=this;this.$axios.get("/api/admin/history",{params:{book_id:this.book_id,begin_date:this.value[0]?this.value[0]:"",end_date:this.value[1]?this.value[1]:"",start:this.currentPage-1,limit:this.pageSize}}).then(function(e){t.tableData=e.data.list,t.total=e.data.total})},getUserDetail:function(){var t=this;this.$axios.get("/api/admin/borrowUserDetails",{params:{book_id:this.book_id}}).then(function(e){1===e.data.code?t.borrowUser.borrowstatus=1:t.borrowUser=e.data})},handlePageChange:function(t){this.currentPage=t,this.getHistory()}}},D=$,N=(a("6d5e"),Object(c["a"])(D,S,x,!1,null,"0f604c0c",null));N.options.__file="BorrowInfo.vue";var V=N.exports,z={name:"book",components:{bookDialog:d,titleInfo:I,borrowInfo:V},data:function(){return{formValues:{ISBN:"",name:"",status:""},dialogFormVisible:!1,form:{ISBN:"",size:1},card_num:{total:0,borrow:0,statistic:0},bookList:[],currentPage:1,pageSize:5,total:0,showSummary:!0,bookInfo:{},commentData:[],commentTitle:"评论（0）",likeData:[],likeTitle:"喜欢（0）",book_id:"",dialogPullOfVisible:!1}},filters:{f1:function(t){var e={"-100":"锁定","-99":"未还","-98":"架上"};return e[t]?e[t]:"延期"+t+"天"}},created:function(){this.getTotal(),this.getBorrow(),this.getStatistic(),this.getBookByISBN()},methods:{addBook:function(){this.form={ISBN:"",size:1},this.$refs.dialog.open("添加图书")},modifyBook:function(){this.form={ISBN:this.bookInfo.ISBN,size:this.bookList.length},this.$refs.dialog.open("修改图书")},deleteBook:function(){this.dialogPullOfVisible=!0},confirmDelete:function(){var t=this;this.$axios.post("/api/admin/pullOffBook",{book_id:this.book_id}).then(function(e){0===e.data.code&&(t.getBookByISBN(),t.dialogPullOfVisible=!1),t.$message({message:e.data.message,type:0===e.data.code?"success":"error"})})},getTotal:function(){var t=this;this.$axios.get("/api/count/book").then(function(e){t.card_num.total=e.data})},getBorrow:function(){var t=this;this.$axios.get("/api/count/borrow").then(function(e){t.card_num.borrow=e.data})},getStatistic:function(){var t=this;this.$axios.get("/api/count/haveBook").then(function(e){t.card_num.statistic=e.data})},getBookByISBN:function(){var t=this;this.$axios.get("/api/admin/getBooksByISBN",{params:{ISBN:this.formValues.ISBN,name:this.formValues.name,status:this.formValues.status,start:(this.currentPage-1)*this.pageSize,end:this.currentPage*this.pageSize}}).then(function(e){t.bookList=e.data.data,t.total=e.data.all,t.$nextTick(function(){t.showSummary=!0,t.bookInfo=e.data.data[0].list[0],t.getComment(t.bookInfo.ISBN),t.getUserLike(t.bookInfo.ISBN)})})},getComment:function(t){var e=this;this.$axios.get("/api/book/comment",{params:{ISBN:t,start:0,limit:5}}).then(function(t){e.commentData=t.data.list,e.commentTitle="评论（"+t.data.total+"）"})},getUserLike:function(t){var e=this;this.$axios.get("/api/admin/userLike",{params:{ISBN:t}}).then(function(t){1!==t.data.code?(e.likeData=t.data,e.likeTitle="喜欢（"+t.data.length+"）"):(e.likeData=[],e.likeTitle="喜欢（0）")})},selectMenu:function(t){var e=this;this.book_id=t,this.showSummary=!1,this.$nextTick(function(){e.$refs.borrowInfo.getHistory(),e.$refs.borrowInfo.getUserDetail()})},clickMenu:function(t){this.showSummary=!0,this.book_id="",this.bookInfo=this.bookList.filter(function(e){return t==e.ISBN})[0].list[0],this.getComment(t),this.getUserLike(t)},handlePageChange:function(t){console.log(t),this.currentPage=t,this.getBookByISBN()}}},P=z,T=(a("d651"),Object(c["a"])(P,i,s,!1,null,"474867a8",null));T.options.__file="Book.vue";e["default"]=T.exports},"978b":function(t,e,a){},d651:function(t,e,a){"use strict";var i=a("f579"),s=a.n(i);s.a},ded8:function(t,e,a){"use strict";var i=a("29b9"),s=a.n(i);s.a},f579:function(t,e,a){},fea4:function(t,e,a){}}]);
//# sourceMappingURL=chunk-aa29.f004419b.js.map